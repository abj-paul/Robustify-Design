<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload UML Files and Specification</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .container {
            margin-top: 30px;
        }
        .card {
            margin-bottom: 20px;
            border: none;
        }
        .form-group label {
            font-weight: bold;
        }
        .btn-primary {
            border-color: transparent;
            border-radius: 20px;
        }
        .btn-clear {
            margin-top: 10px;
            border-radius: 20px;
        }
        .response {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
        }
        .form-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .form-buttons .btn {
            flex: 1;
        }
        .form-buttons .btn-primary {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mt-5" id="project-name">Project: Untitled..</h1>
        <!-- Nav tabs -->
        <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="metadata-tab" data-toggle="tab" href="#metadata" role="tab" aria-controls="metadata" aria-selected="true">Project Details</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="system-tab" data-toggle="tab" href="#system" role="tab" aria-controls="system" aria-selected="false">System Specification</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="user-tab" data-toggle="tab" href="#user" role="tab" aria-controls="user" aria-selected="false">User Environment</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="safety-tab" data-toggle="tab" href="#safety" role="tab" aria-controls="safety" aria-selected="false">Safety Property</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="additional-tab" data-toggle="tab" href="#additional" role="tab" aria-controls="additional" aria-selected="false">Configurations</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="text-tab" data-toggle="tab" href="#text" role="tab" aria-controls="text" aria-selected="false">Robustify</a>
            </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content" id="myTabContent">
            <!-- Project Details Tab -->
            <div class="tab-pane fade show active" id="metadata" role="tabpanel" aria-labelledby="metadata-tab">
                <div class="row mt-5">
                    <div class="col-md-6 offset-md-3">
                        <form id="create-project-form">
                            <div class="form-group">
                                <label for="project-name">Project Name</label>
                                <input type="text" class="form-control" id="project-name" name="project_name" required>
                            </div>
                            <div class="form-group">
                                <label for="project-description">Project Description</label>
                                <textarea class="form-control" id="project-description" name="project_description" rows="4" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="project-image">Project Image</label>
                                <input type="file" class="form-control-file" id="project-image" name="project_image">
                            </div>
                            <button type="button" class="btn btn-primary btn-block" onclick="createProject()">Create Project</button>                        </form>
                    </div>
                </div>
            </div>

            <!-- System Specification Tab -->
            <div class="tab-pane fade" id="system" role="tabpanel" aria-labelledby="system-tab">
                <div class="row mt-5">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <form id="upload-form-files-1">
                                    <div class="form-group">
                                        <label for="files-1">Choose UML files</label>
                                        <input type="file" class="form-control-file" id="files-1" name="files" multiple>
                                    </div>
                                    <div class="form-buttons">
                                        <button type="submit" class="btn btn-primary btn-block">Upload</button>
                                        <button type="button" class="btn btn-secondary btn-block btn-clear" onclick="clearForm('upload-form-files-1', 'response-files-1')">Clear</button>
                                    </div>
                                </form>
                                <div id="response-files-1" class="response mt-3"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <form id="upload-form-spec-1">
                                    <div class="form-group">
                                        <label for="filename-1">Filename</label>
                                        <input type="text" class="form-control" id="filename-1" name="filename" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="specification-1">Formal Specification</label>
                                        <textarea class="form-control" id="specification-1" name="specification" rows="4" required></textarea>
                                    </div>
                                    <div class="form-buttons">
                                        <button type="submit" class="btn btn-primary btn-block">Upload</button>
                                        <button type="button" class="btn btn-secondary btn-block btn-clear" onclick="clearForm('upload-form-spec-1', 'response-spec-1')">Clear</button>
                                    </div>
                                </form>
                                <div id="response-spec-1" class="response mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Environment Tab -->
            <div class="tab-pane fade" id="user" role="tabpanel" aria-labelledby="user-tab">
                <div class="row mt-5">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <form id="upload-form-files-2">
                                    <div class="form-group">
                                        <label for="files-2">Choose UML files</label>
                                        <input type="file" class="form-control-file" id="files-2" name="files" multiple>
                                    </div>
                                    <div class="form-buttons">
                                        <button type="submit" class="btn btn-primary btn-block">Upload</button>
                                        <button type="button" class="btn btn-secondary btn-block btn-clear" onclick="clearForm('upload-form-files-2', 'response-files-2')">Clear</button>
                                    </div>
                                </form>
                                <div id="response-files-2" class="response mt-3"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <form id="upload-form-spec-2">
                                    <div class="form-group">
                                        <label for="filename-2">Filename</label>
                                        <input type="text" class="form-control" id="filename-2" name="filename" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="specification-2">Formal Specification</label>
                                        <textarea class="form-control" id="specification-2" name="specification" rows="4" required></textarea>
                                    </div>
                                    <div class="form-buttons">
                                        <button type="submit" class="btn btn-primary btn-block">Upload</button>
                                        <button type="button" class="btn btn-secondary btn-block btn-clear" onclick="clearForm('upload-form-spec-2', 'response-spec-2')">Clear</button>
                                    </div>
                                </form>
                                <div id="response-spec-2" class="response mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Safety Property Tab -->
            <div class="tab-pane fade" id="safety" role="tabpanel" aria-labelledby="safety-tab">
                <div class="row mt-5">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <form id="upload-form-files-3">
                                    <div class="form-group">
                                        <label for="files-3">Choose UML files</label>
                                        <input type="file" class="form-control-file" id="files-3" name="files" multiple>
                                    </div>
                                    <div class="form-buttons">
                                        <button type="submit" class="btn btn-primary btn-block">Upload</button>
                                        <button type="button" class="btn btn-secondary btn-block btn-clear" onclick="clearForm('upload-form-files-3', 'response-files-3')">Clear</button>
                                    </div>
                                </form>
                                <div id="response-files-3" class="response mt-3"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <form id="upload-form-spec-3">
                                    <div class="form-group">
                                        <label for="filename-3">Filename</label>
                                        <input type="text" class="form-control" id="filename-3" name="filename" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="specification-3">Formal Specification</label>
                                        <textarea class="form-control" id="specification-3" name="specification" rows="4" required></textarea>
                                    </div>
                                    <div class="form-buttons">
                                        <button type="submit" class="btn btn-primary btn-block">Upload</button>
                                        <button type="button" class="btn btn-secondary btn-block btn-clear" onclick="clearForm('upload-form-spec-3', 'response-spec-3')">Clear</button>
                                    </div>
                                </form>
                                <div id="response-spec-3" class="response mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="additional" role="tabpanel" aria-labelledby="additional-tab">
                <div class="card">
                    <div class="card-body">
                        <form id="additional-inputs-form">
                            <div class="form-group">
                                <label for="progress">Progress</label>
                                <input type="text" class="form-control" id="progress" name="progress" placeholder='["confirm"]'>
                            </div>
                            <div class="form-group">
                                <label for="preferredMap">Preferred Map (JSON)</label>
                                <input type="text" class="form-control" id="preferredMap" name="preferredMap" placeholder='{ "3": [["scan", "check_price", "print_cmd", "print"]] }'>
                            </div>
                            <div class="form-group">
                                <label for="controllableMap">Controllable Map (JSON)</label>
                                <input type="text" class="form-control" id="controllableMap" name="controllableMap" placeholder='{ "1": ["check_price", "print_cmd"], "3": ["print", "scan"] }'>
                            </div>
                            <div class="form-group">
                                <label for="observableMap">Observable Map (JSON)</label>
                                <input type="text" class="form-control" id="observableMap" name="observableMap" placeholder='{ "0": ["check_price", "print_cmd"], "2": ["print", "scan"] }'>
                            </div>
                            <div class="form-buttons">
                                <button type="submit" class="btn btn-primary btn-block">Save Configurations</button>
                                <button type="button" class="btn btn-secondary btn-block btn-clear" onclick="clearForm('additional-inputs-form')">Clear</button>
                            </div>
                        </form>
                        <div id="response-additional" class="response mt-3"></div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="text" role="tabpanel" aria-labelledby="text-tab">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <form id="execute-fortis-form">
                                    <div class="form-group">
                                        <label for="system-class-list">Class List:</label>
                                        <input type="text" class="form-control" id="system-class-list" name="system-class-list">
                                    </div>
                                    <div class="form-buttons">
                                        <button id="execute-fortis-btn" type="submit" class="btn btn-primary btn-block">Execute Fortis</button>
                                        <button type="button" class="btn btn-secondary btn-block btn-clear" onclick="clearForm('system-class-list')">Clear</button>
                                    </div>
                                </form>
                                <div id="response-text" class="response mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        let project_folder = "NOT SET";
        function clearForm(formId, responseId) {
            document.getElementById(formId).reset();
            document.getElementById(responseId).innerText = ''; // Clear the response content
        }

        // Adding event listeners for each form submission
        for(let i = 1; i <= 3; i++) {
            document.getElementById(`upload-form-files-${i}`).addEventListener('submit', async function(event) {
                event.preventDefault();

                const formData = new FormData();
                const fileFields = document.querySelector(`#files-${i}`).files;

                for (let j = 0; j < fileFields.length; j++) {
                    formData.append('files', fileFields[j]);
                }
                formData.append("project_folder",project_folder);

                const response = await fetch('http://localhost:8000/upload/files/', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                document.getElementById(`response-files-${i}`).innerText = JSON.stringify(result, null, 2);
            });

            document.getElementById(`upload-form-spec-${i}`).addEventListener('submit', async function(event) {
                event.preventDefault();

                const formData = new FormData();
                const filename = document.getElementById(`filename-${i}`).value;
                const specification = document.getElementById(`specification-${i}`).value;

                formData.append('filename', filename);
                formData.append('specification', specification);
                formData.append("project_folder",project_folder);


                const response = await fetch('http://localhost:8000/upload/specification/', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                document.getElementById(`response-spec-${i}`).innerText = JSON.stringify(result, null, 2);
            });

            function createProject() {
                const form = document.getElementById('create-project-form');
                const formData = new FormData(form);
                console.log(formData);
                fetch('http://localhost:8000/create_project/', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    project_folder = data.project_folder;
                    document.getElementById("project-name").innerText = data.project_name;
                    // Optionally, you can redirect or show a success message here
                    alert('Project created successfully!');
                    // Reset the form after successful submission
                    form.reset();
                })
                .catch((error) => {
                    console.error('Error:', error);
                    // Handle errors or show an error message
                    alert('An error occurred while creating the project.');
                });
            }
        }

    document.getElementById('additional-inputs-form').addEventListener('submit', async function(event) {
        event.preventDefault();

        const formData = new FormData();
        const progress = document.getElementById('progress').value;
        const preferredMap = document.getElementById('preferredMap').value;
        const controllableMap = document.getElementById('controllableMap').value;
        const observableMap = document.getElementById('observableMap').value;

        formData.append('progress', progress);
        formData.append('preferredMap', preferredMap);
        formData.append('controllableMap', controllableMap);
        formData.append('observableMap', observableMap);
        formData.append('project_folder', project_folder);

        console.log(formData);

        const response = await fetch('http://localhost:8000/configuration', {
            method: 'POST',
            body: formData
        });

        const result = await response.json();
        document.getElementById('response-additional').innerText = JSON.stringify(result, null, 2);
    });

    document.getElementById('execute-fortis-form').addEventListener('submit', async function(event) {
        event.preventDefault();
        
        const formData = new FormData();
        let class_list_input = document.getElementById('system-class-list').value;
        const class_list = class_list_input.split(",");

        formData.append('project_folder', project_folder);
        for (let j = 0; j < class_list.length; j++) {
            formData.append('class_list', class_list[j]);
        }
        console.log(formData);

        const response = await fetch('http://localhost:8000/execute', {
            method: 'POST',
            body: formData
        });

        const result = await response.json();
        document.getElementById('response-text').innerText = JSON.stringify(result, null, 2);
    });

    </script>
</body>
</html>
